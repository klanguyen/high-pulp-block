(()=>{"use strict";var e={352:(e,t,a)=>{var n=a(34);t.C=n.createRoot,n.hydrateRoot},34:e=>{e.exports=window.ReactDOM}},t={};function a(n){var l=t[n];if(void 0!==l)return l.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=window.React;var t,n=a.n(e),l=a(352);class o extends n().Component{state={title:"",description:"",posterId:"",genres:[],voteCount:0,submittedBy:""};openMediaLibrary(e){e.preventDefault(),(t=wp.media({title:"Upload Image",type:"image",multiple:!1,button:{text:"Done"}}).open()).on("select",(e=>{var a=t.state().get("selection").first().toJSON().id;this.setState({posterId:a})}))}handleCheckboxChange(e){let t=[...this.state.genres,e.target.value];this.state.genres.includes(e.target.value)&&(t=t.filter((t=>t!==e.target.value))),this.setState({genres:t})}addMovie(e){e.preventDefault(),console.log(this.state.posterId);const t={title:this.state.title,content:this.state.description,featured_media:this.state.posterId,acf:{movie_genres:this.state.genres,movie_vote_count:parseInt(this.state.rating)||0,movie_submitted_by:this.state.submittedBy},status:"publish"};this.props.addMovie?.(t),this.setState({title:"",description:"",posterId:"",genres:"",submittedBy:""}),jQuery(document.querySelectorAll('input[name="genres"]').forEach((e=>e.checked=!1)))}render(){return(0,e.createElement)("form",{className:"new-movie-form",onSubmit:e=>this.addMovie(e)},(0,e.createElement)("div",null,(0,e.createElement)("label",null,"Title:",(0,e.createElement)("input",{type:"text",value:this.state.title,onInput:e=>this.setState({title:e.target.value})}))),(0,e.createElement)("div",null,(0,e.createElement)("label",null,"Poster Image"),(0,e.createElement)("br",null),(0,e.createElement)("button",{type:"button",onClick:e=>this.openMediaLibrary(e)},"Upload Image")),(0,e.createElement)("div",null,(0,e.createElement)("label",null,"Description:",(0,e.createElement)("textarea",{value:this.state.description,onInput:e=>this.setState({description:e.target.value})}))),(0,e.createElement)("div",null,(0,e.createElement)("label",null,"Genres:"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"horror",value:"Horror",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"horror"},"Horror"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"action",value:"Action",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"action"},"Action"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"sci-fi",value:"Sci-Fi",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"sci-fi"},"Sci-Fi"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"drama",value:"Drama",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"drama"},"Drama"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"mystery",value:"Mystery",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"mystery"},"Mystery"),(0,e.createElement)("br",null),(0,e.createElement)("input",{type:"checkbox",id:"comedy",value:"Comedy",name:"genres",onChange:e=>this.handleCheckboxChange(e)}),(0,e.createElement)("label",{htmlFor:"comedy"},"Comedy")),(0,e.createElement)("div",null,(0,e.createElement)("label",null,"Submitted by:",(0,e.createElement)("input",{type:"text",value:this.state.submittedBy,onInput:e=>this.setState({submittedBy:e.target.value})}))),(0,e.createElement)("button",{type:"submit"},"Add Movie"))}}class s extends n().Component{render(){let{title:t,description:a,posterUrl:n,genres:l,voteCount:o,submittedBy:s,movieId:i}=this.props;return(0,e.createElement)("span",{className:"movie-info"},(0,e.createElement)("img",{src:n,className:"movie-image"}),(0,e.createElement)("span",{className:"movie-data"},(0,e.createElement)("h4",{className:"movie-title",dangerouslySetInnerHTML:{__html:t}}),(0,e.createElement)("span",null,"Submitted by: ",s),(0,e.createElement)("ul",{className:"movie-genres"},l.map((t=>(0,e.createElement)("li",{className:"genre-item"},t)))),(0,e.createElement)("p",{className:"movie-description",dangerouslySetInnerHTML:{__html:a}}),(0,e.createElement)("span",{className:"vote-count"},o," votes")))}}class i extends n().Component{setSelectedMovieId(e){e.preventDefault(),this.props.getSelectedMovieId?.(e.target.value),console.log("Movie List selected: "+e.target.value)}render(){return(0,e.createElement)("div",{className:"movie-list"},this.props.movies.map((t=>(0,e.createElement)("div",{className:"movie-card"},(0,e.createElement)("label",{className:"movie-wrapper"},(0,e.createElement)("input",{type:"radio",name:"movie-of-the-month",className:"movie-input",value:t.attributes.id,onChange:e=>this.setSelectedMovieId(e)}),(0,e.createElement)(s,{title:t.attributes.title.rendered,description:t.attributes.content.rendered,posterUrl:t.attributes._embedded["wp:featuredmedia"][0].source_url,genres:t.attributes.acf.movie_genres,voteCount:t.attributes.acf.movie_vote_count,submittedBy:t.attributes.acf.movie_submitted_by,movieId:t.attributes.id,key:t.attributes.id}))))))}}class r extends n().Component{state={movies:[],loggedIn:null,selectedMovieId:"",newVoteCount:0};addMovie(e){new wp.api.models.Movie(e).save().done((e=>{console.log("Successfully added movie!",e),this.getMovies()})).fail((e=>{console.error("Failed adding movie!",e)}))}getMovies(){const e=new wp.api.collections.Movie;e.fetch({data:{_embed:!0},orderby:"title",order:"DESC"}).done((t=>{console.log("Successfully fetched!",t,e),this.setState({movies:e.models})})).fail((e=>{console.error("Failed fetching!",e)}))}handleInput(e){this.setState({selectedMovieId:parseInt(e)})}updateSelectedMovie(e){e.preventDefault(),console.log("Voting for movie id: "+this.state.selectedMovieId);const t=new wp.api.models.Movie({id:this.state.selectedMovieId});t.fetch().done((e=>{console.log("Successfully fetched!",e,t),this.setState({newVoteCount:t.attributes.acf.movie_vote_count+1},(()=>{console.log("New vote count: "+this.state.newVoteCount),t.save({acf:{movie_vote_count:this.state.newVoteCount}},{patch:!0}).done((e=>{console.log("Successfully updated movie",e),this.getMovies()})).fail((e=>{console.error("Failed updating movie",e)}))}))})).fail((e=>{console.error("Failed fetching!",e)}))}getLoggedInUser(){(new wp.api.models.UsersMe).fetch().done((e=>{this.setState({loggedIn:!0})})).fail((e=>{this.setState({loggedIn:!1})}))}componentDidMount(){this.getMovies(),this.getLoggedInUser()}render(){return(0,e.createElement)("div",null,(0,e.createElement)("div",{className:"vote-section"},(0,e.createElement)("h3",null,"Latest Movies"),(0,e.createElement)(i,{movies:this.state.movies,getSelectedMovieId:e=>this.handleInput(e)}),(0,e.createElement)("button",{className:"vote-button",onClick:e=>this.updateSelectedMovie(e)},"Vote")),(0,e.createElement)("hr",null),(0,e.createElement)("h3",null,"Submit a Movie"),!0===this.state.loggedIn&&(0,e.createElement)(o,{addMovie:e=>this.addMovie(e)}),!1===this.state.loggedIn&&(0,e.createElement)("div",{className:"error-msg"},"You must be logged in to submit a movie"))}}document.querySelectorAll(".wp-block-kn-submit-movie").forEach((t=>{(0,l.C)(t).render((0,e.createElement)(r,null))}))})()})();